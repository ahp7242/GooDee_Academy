<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="com.picaboo.nor.customer.mapper.CustomerMapper">
	
	<!-- 좌석 출력 -->
	<select id="selectSeat" resultType="com.picaboo.nor.franchisee.vo.Seat" parameterType="String">
		<![CDATA[
			SELECT franchisee_no as franchiseeNo,
				   seat_no as seatNo,
				   seat_row as seatRow,
				   seat_cols as seatCols,
				   seat_use as seatUse
			FROM seat 
			WHERE franchisee_no = #{String}
		]]>
	</select>
	<!-- 모든 프렌차이즈 정보를 가져옴 -->
	<select id="selectFranchiseeNo" resultType="com.picaboo.nor.franchisee.vo.Franchisee">
		<![CDATA[
			SELECT 
					franchisee_no as franchiseeNo,
					franchisee_name as franchiseeName
			FROM franchisee
		]]>
	</select>
	<!-- 프렌차이즈 상세정보를 가져옴 -->
	<select id="selectFranchisee" parameterType="String" resultType="com.picaboo.nor.franchisee.vo.Franchisee">
		<![CDATA[
			SELECT 
					franchisee_no as franchiseeNo,
					franchisee_name as franchiseeName
			FROM franchisee
			WHERE franchisee_no = #{franchiseeNo}
		]]>
	</select>
	
	<!-- 좌석 예약 -->
	<insert id="insertSeatReservation" parameterType="com.picaboo.nor.customer.vo.SeatReservation">
		<![CDATA[
			INSERT INTO seat_reservation (
				franchisee_no,
				seat_no,
				customer_name,
				customer_no,
				reservation_date
			) VALUES (
				#{franchiseeNo},
				#{seatNo},
				#{customerName},
				#{customerNo},
				#{reservationDate}
			)
		]]>
	</insert>
	
	<!-- 예약한 좌석 타입 변경 -->
	<update id="updateSeatType" parameterType="com.picaboo.nor.customer.vo.SeatReservation">
		<![CDATA[
			UPDATE seat 
			SET seat_use = #{type}
			WHERE franchisee_no = #{franchiseeNo} AND seat_no = #{seatNo}
		]]>
	</update>
	
	<!-- 예약된 좌석중 시간이 10분 지난 리스트 -->
	<select id="selectSeatReservation" parameterType="String"
									   resultType="com.picaboo.nor.customer.vo.SeatReservation">
		<![CDATA[
			SELECT franchisee_no as franchiseeNo,
				   seat_no as seatNo,
				   customer_no as customerNo,
				   customer_name as customerName,
				   reservation_date as reservationDate
			FROM seat_reservation
			WHERE reservation_date <= date_add(NOW(),INTERVAL 10 minute) AND franchisee_no = #{franchiseeNo}
		]]>
	</select>
	
	<!-- 예약기간이 지난 예약 을 cancel테이블로 이동 -->
	<insert id="insertCancelSeatReaservation" parameterType="com.picaboo.nor.customer.vo.SeatReservation">
		<![CDATA[
			INSERT INTO cancel_seat_reservation (
				franchisee_no,
				seat_no,
				customer_name,
				customer_no,
				reservation_date
			) VALUES (
				#{franchiseeNo},
				#{seatNo},
				#{customerName},
				#{customerNo},
				#{reservationDate}
			)
		]]>
	</insert>
	
	<!-- 예약기간이 지난 예약 삭제 -->
	<delete id="deleteSeatReservation" parameterType="com.picaboo.nor.customer.vo.SeatReservation">
		<![CDATA[
			DELETE FROM seat_reservation
			WHERE franchisee_no = #{franchiseeNo} AND seat_no = #{seatNo}
		]]>
	</delete>
	
	<!-- 프렌차이즈의 대표 이미지 가져옴 -->
	<select id="selectFranchiseeThumbnail" resultType="com.picaboo.nor.franchisee.vo.FranchiseePic">
		<![CDATA[
			SELECT
				MIN(pic_no) as picNo,
				franchisee_no as franchiseeNo,
				file_name as fileName,
				extension as extension,
				content_type as contentType,
				size as size,
				origin_name as originName
			FROM franchisee_pic
			GROUP BY franchisee_no
		]]>
	</select>
	
	<!-- 선택된 프렌차이즈의 이미지를 가져옴 -->
	<select id="selectFranchiseeThumbnailList" parameterType="String" resultType="com.picaboo.nor.franchisee.vo.FranchiseePic">
		<![CDATA[
			SELECT
				pic_no as picNo,
				franchisee_no as franchiseeNo,
				file_name as fileName,
				extension as extension,
				content_type as contentType,
				size as size,
				origin_name as originName
			FROM franchisee_pic
			WHERE franchisee_no = #{franchiseeNo}
		]]>
	</select>
	
	<!-- 선택된 프렌차이즈에 등록된 상품목록을 가져옴 -->
	<select id="selectFoodList" parameterType="String" resultType="com.picaboo.nor.franchisee.vo.Food">
		<![CDATA[
			SELECT
				food_no as foodNo,
				food_name as foodName,
				food_category as foodCategory,
				food_price as foodPrice
			FROM food
			WHERE franchisee_no = #{String}
		]]>
	</select>
	
	<!-- 프렌차이즈의 스펙을 가져옴 -->
	<select id="selectSpecList" resultType="com.picaboo.nor.franchisee.vo.FranchiseeSpec">
		<![CDATA[
			SELECT
				franchisee_no as franchiseeNo,
				cpu as cpu,
				vga as vga,
				ram as ram
			FROM franchisee_spec
		]]>
	</select>
	
	<!-- 예약한 상품을 데이터베이스에 저장 -->
	<insert id="insertFoodReservation" parameterType="com.picaboo.nor.customer.vo.FoodReservation">
		<![CDATA[
			INSERT INTO food_reservation (
				food_no,
				reservation_count,
				reservation_date,
				customer_no,
				customer_name
			) VALUES (
				#{foodNo},
				#{reservationCount},
				#{reservationDate},
				#{customerNo},
				#{customerName}
			)
		]]>
	</insert>
	
	<!-- 예약된 상품중 기간이 10분 지난 리스트를 가져옴 -->
	<select id="selectFoodReservation" parameterType="String" resultType="com.picaboo.nor.customer.vo.FoodReservation">
		<![CDATA[
			SELECT 
				fr.reservation_no as reservationNo,
				fr.food_no as foodNo, 
				fr.reservation_count as reservationCount, 
				fr.reservation_date as reservationDate, 
				fr.customer_no as customerNo, 
				fr.customer_name as customerName
			FROM food_reservation as fr INNER JOIN food as f
			ON fr.food_no = f.food_no
			WHERE franchisee_no = #{franchiseeNo} AND fr.reservation_date <= date_add(NOW(),INTERVAL 10 minute)
		]]>
	</select>
	
	<!-- 예약된 상품중 기간이 10분지난 목록을 cancel테이블로 이동 -->
	<insert id="insertCancelFoodReservation" parameterType="com.picaboo.nor.customer.vo.FoodReservation">
		<![CDATA[
			INSERT INTO cancel_food_reservation (
				food_no,
				reservation_count,
				reservation_date,
				customer_no,
				customer_name
			) VALUES (
				#{foodNo},
				#{reservationCount},
				#{reservationDate},
				#{customerNo},
				#{customerName}
			)
		]]>
	</insert>
	
	<!-- 예약된 상품중 기간이 10분지난 목록을 예약 테이블에서 삭제 -->
	<delete id="deleteFoodReservation" parameterType="int">
		<![CDATA[
			DELETE FROM food_reservation
			WHERE reservation_no = #{reservationNo}
		]]>
	</delete>
</mapper>